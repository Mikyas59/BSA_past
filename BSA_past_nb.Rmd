---
title: "BSA_past_13-18"
output: html_notebook
---

```{r libraries}
library(tidyverse)
library(flexdashboard)
library(psych)
library(qualtRics)
library(usethis)
library(sjlabelled)
library(stringr)
library(lubridate)

use_github(protocol = "https", auth_token = Sys.getenv("GITHUB_PAT"))
```

```{r}
BSA_past18<- read_survey("H:/BSA/BSA Data 2013-2018.csv")

questions<-data.frame(names(BSA_past18), get_label(BSA_past18))

##Look at how many finished survey/level of progress
describe(BSA_past18$Progress)

##Make a copy of original file. 
BSA_past18.2 <- BSA_past18


##Extract date from datetime values in EndDate variable. 
BSA_past18.2 <- separate(BSA_past18.2, EndDate, into = c("Survey_enddate", "surveyendtime"), sep = " ", remove = FALSE, convert = TRUE)

##Extract year values from survey _enddate variable and deltete extraneous values. 

BSA_past18.2$survey_year <- str_sub(BSA_past18.2$Survey_enddate, -4, -1)

BSA_past18.2 <- BSA_past18.2 %>%
  select(-c(surveyendtime))
  

##overall 14,024 responses. Breakdown number of responses by year. 
BSA_past18.2 %>%
  group_by(survey_year)%>%
  count(n())

  
```

```{r}
##How many times did orgs take survey?
BSA_past18.2 %>%
  group_by(Org_Name, survey_year) %>%
  count(n())
##There may be a number of cases where only one participant took survey in a particular year (likely a case of different survey end dates)
##A number of surveys without org names. could be derived from ImportedSurveyName. 

##Assign org-name for those without an orgname derived from the Importedsurveyname. 
##58 observations with no orgname.  
BSA_past18.2 %>%
  filter(is.na(Org_Name))

BSA_past18.2$Org_Name <- if_else(is.na(BSA_past18.2$Org_Name), str_sub(BSA_past18.2$ImportedFromSurveyName, 1, -5), BSA_past18.2$Org_Name)

##for orgname==Edgewood, survey year =2014. orgname==PENCIL, year==2014. 
##for orgname==National CASA association Pennsylvania, year ==2017

##New survey year variable adopted from the ImportedfromsurveyName varialbe. 

##BSA_past18.2$survey_year2 <- str_sub(BSA_past18.2$ImportedFromSurveyName, -4, -1)

BSA_past18.2 <- BSA_past18.2%>%
  mutate(survey_year2 = case_when(
    BSA_past18.2$Org_Name == "Edgewood" ~ "2014",
    BSA_past18.2$Org_Name == "PENCIL" ~ "2014",
    BSA_past18.2$Org_Name == "National CASA Association - Pennsylvania" ~ "2017",
    TRUE ~ str_sub(BSA_past18.2$ImportedFromSurveyName, -4, -1))
  )

##Fit typo of year 2106 to 2016. 
BSA_past18.2$survey_year2 <- if_else(BSA_past18.2$survey_year2 == "2106", "2016", BSA_past18.2$survey_year2)

table(BSA_past18.2$survey_year2)

##Get rid of phrases "Board Assessment" and "BSA" for orgnames derived from the importedsurveyname 
table(str_which(BSA_past18.2$Org_Name, "BSA"))
table(str_detect(BSA_past18.2$Org_Name, "Board Assessment"))

BSA_past18.2$Org_Name <- str_remove(BSA_past18.2$Org_Name, "BSA" )
BSA_past18.2$Org_Name <- str_remove(BSA_past18.2$Org_Name, "Board Assessment")


table(str_detect(BSA_past18.2$Org_Name, "BSA"))


##How many times have orgs taken the survey 
BSA_past18.3 <- BSA_past18.2 %>%
  group_by(Org_Name)%>%
  arrange(Org_Name)%>%
  distinct(survey_year2)

##Need a way to limit a copy dataset to just orgs who have taken the survey more than once. 
##74 organizations have taken the survey more than once. 
BSA_past_multi <- BSA_past18.3 %>%
  count(n()) %>%
  filter(n>1)

```

```{r basic board performance summary}
#Overall summary of board performance aka Benchmarking. 


```

